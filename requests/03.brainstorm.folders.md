# Task

This is a fresh project ( no code ).

We are in specifications period.

I already made the following BMAD workflows:
- brainstorm
- Product Brief
- UI-UX
- Architecture

We brainstorm on new ideas/changes to operate on the current state. Then I will use `/bmad:bmm:workflows:correct-course`

## Idea 1: Folder

## Claude code tied folder path to session

I realise that claude code session is tied to a folder.

```claude doc
How It Works

  Sessions are stored per-project at:
  ~/.claude/projects/{PROJECT_PATH_ENCODED}/

  When you --resume, Claude Code looks for sessions in the current directory's project path, not globally.
```

It recommends:

```
Workarounds

  1. Always launch Claude Code from the same working directory for a given session
  2. Store the cwd alongside session_id in your app's database, and cd there before resuming
  3. Use --no-session-persistence and manage conversation history entirely in your app

  For your use case, you'd likely need to:
  // In your app
  const sessions = {
    "conv-1": { sessionId: "abc-123", cwd: "/dev/project-a" },
    "conv-2": { sessionId: "def-456", cwd: "/dev/project-b" }
  }

  // When resuming, spawn claude in the correct directory
  spawn("claude", ["--resume", session.sessionId], { cwd: session.cwd })
```

## Impact on Grimoire

### Selecting folder in Grimoire

When start a new session, it should be tied to a folder.

We need to collect a folder from the user.

What would be the best approach in terms of UI to maintain our target of efficiency ?

- When clicking on new session, show the folder selection ?
- When open app, since we go to new session screen, opening folder selection would be a bit too much ?

### Selection folder outside Grimoire

- Typing `grimoire .` in the terminal open a new session from within this folder ( and prepare a stream directly ).

- Contextual menu, when right click in a empty space from folder "Open with Grimoire" or when right click on a folder. Same behavior as above.

### Data management

We simply need to save the path on top of the session ID

### New Right Panel

Since a session is in a folder, the right panel have a new panel, the folder three. It show all files with the classic setup similar to obsidian, to collaps/uncollaps all, collapse folders etc..

It list all files.

MD files, when click, open in the middle panel a new tab to visualise the file (later feature to edit but not for now).

### Session list filter

In the session list, we can filter per date (last message), but also per folder. When clicking the folder filter, it show all existing folder with fuzy matching search to select one or many to display. And we can undo with one click, after selecting a folder filter, a button appear to reset.

### New left panel: Folder Three

In the left panel displaying the session, another panel is Folders, where is displayed the file three of the folder related to this session.

It is a three architecture. If a session is withing a sub folder of another session, then it will be displayed hierarchically

eg.

```
- Folder A
  - Folder A.1
    - Session
    - Session
  - Session
  - Session
```

Some folder does not have parents session (they dont have any session existing in their parent folder), this is the one we list in this new panel as root of the three. Visually it should indicate how many session within the folder. It shows the number of session + SUM of session in all sub folder recursively.

Eg.

```
- Folder A (4)
  - Folder A.1 (2)
    - Session
    - Session
  - Session
  - Session
```

Of course visually it match with our design.

### File history for folder listing

When the workflow run, we should be able to detect what files is edited by the model. We save the info and display it in the right panel, the folder three. Similarly to VS Code, when a file have been edited, it will be displayed with a different color, and an icon number showing the number of editions. When click on the file, on top of the 